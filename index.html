<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa de Galerías de Arte - Multilenguaje</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0; padding: 0; font-family: Arial, sans-serif;
    }
    #map {
      height: 100vh;
      width: 100%;
    }
    /* Botón toggle idioma */
    #language-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
    }
    #language-toggle button {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 6px 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Botón toggle idioma -->
  <div id="language-toggle">
    <button id="toggle-language">EN</button>
  </div>

  <div id="map"></div>
  
  <div id="update-date" style="text-align:center; margin:8px 0; font-size: 0.9em; color: #555;">
  Última actualización: <span id="last-update"></span>
</div>

<div id="gallery-select-container" style="padding: 10px; background: #f7f7f7; border-top: 1px solid #ccc;">
  <label for="gallery-select" style="font-weight: bold;">Selecciona una galería:</label>
  <select id="gallery-select" style="width: 100%; max-width: 400px; padding: 6px; margin-top: 5px;">
    <option value="">-- Elige una galería --</option>
  </select>
</div>
 <script>
    const fechaSpan = document.getElementById('last-update');
    const fecha = new Date();
    const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
    fechaSpan.textContent = fecha.toLocaleDateString('es-ES', opciones);
  </script>
</body>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Inicializar mapa
    const map = L.map('map').setView([36.7213, -4.4214], 13);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors & CartoDB',
      maxZoom: 19,
    }).addTo(map);

    // Datos con descripciones en español y en inglés

const gallerySelect = document.getElementById('gallerySelect');
let markers = [];
let currentLang = 'es'; // puedes cambiar esto dinámicamente si tienes selector de idioma

 fetch('galerias.json')
    .then(response => response.json())
    .then(galerias => {
      // Rellenar la lista con las galerías
      galerias.forEach((galeria, index) => {
        const option = document.createElement('option');
        option.value = index;  // guardamos el índice para referencia
        option.textContent = galeria.nombre;
        gallerySelect.appendChild(option);
      });

      // Función para mostrar marcadores
      function showMarkers() {
        // limpiar marcadores anteriores
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        galerias.forEach(galeria => {
          const descripcion = currentLang === 'es' ? galeria.descripcion_es : galeria.descripcion_en;

          const marker = L.marker([galeria.lat, galeria.lng])
            .addTo(map)
            .bindPopup(`<b>${galeria.nombre}</b><br>${descripcion}`);

          markers.push(marker);
        });
      }

      showMarkers(); // Mostrar inicialmente los marcadores

      // Evento al cambiar la galería seleccionada
      gallerySelect.addEventListener('change', () => {
        const selectedIndex = gallerySelect.value;
        if (selectedIndex === "") return; // nada seleccionado

        const galeria = galerias[selectedIndex];
        const latLng = [galeria.lat, galeria.lng];

        map.setView(latLng, 16);
        markers[selectedIndex].openPopup();
      });
    })
    .catch(error => console.error('Error cargando galerías:', error));

  // Botón toggle idioma
  const toggleBtn = document.getElementById('toggle-language');

  function updateButtonText() {
    toggleBtn.textContent = currentLang === 'es' ? 'EN' : 'ES';
  }

  toggleBtn.addEventListener('click', () => {
    currentLang = currentLang === 'es' ? 'en' : 'es';
    updateButtonText();
    showMarkers();
  });

  // Inicializa texto del botón
  updateButtonText();

  // Mostrar la ubicación del usuario
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(position => {
      const userLat = position.coords.latitude;
      const userLng = position.coords.longitude;

      const userMarker = L.circleMarker([userLat, userLng], {
        radius: 8,
        fillColor: "#3388ff",
        color: "#fff",
        weight: 2,
        opacity: 1,
        fillOpacity: 0.9
      }).addTo(map).bindPopup(currentLang === 'es' ? "Tu ubicación" : "Your location");

      map.setView([userLat, userLng], 14);
    }, error => {
      console.log("No se pudo obtener la ubicación: ", error.message);
    });
  } else {
    console.log("Geolocalización no está disponible en este navegador.");
  }
</script>
</body>
</html>